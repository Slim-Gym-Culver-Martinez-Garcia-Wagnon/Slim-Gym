<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Index page</title>
    <th:block th:include="partials/styles.html :: styles"/>

    <style>
        /* Always set the map height explicitly to define the size of the div
           * element that contains the map. */
        #map {
            position: absolute;
            height: 90%;
            width: 75%;
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            height: 100%;
            position: fixed;
            overflow: hidden;
            margin: 0;
            padding: 0;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .overlay {
            position: fixed;
            overflow-y: scroll;
            margin-top: 70px;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            overscroll-behavior: contain;
        }

        .card {
            font-family: 'Bangers';
        }

    </style>
</head>
<body class="container-fluid" style="width: 100%; margin: 0; padding: 0;">
<th:block th:replace="partials/navbar.html :: navbar"/>
<div class="d-none d-md-block" id="map"></div>
<div class="col-4 ml-auto d-none d-md-block d-lg-none overflow-auto scroll-container overlay"
     style=" background-color: #1a1819">
    <div th:each="gym : ${gyms}">
        <div class="card offwhite-body" style="margin: 5%">
            <div class="preview-post">
                <div id="Profile" class="card-img-top carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#Profile" data-slide-to="0" class="active"></li>
                        <li data-target="#Profile" data-slide-to="1"></li>
                        <li data-target="#Profile" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div th:each="picture : ${pictures}">
                            <div th:if="${picture.gym.getId()} == ${gym.id}">
                                <div class="carousel-item active">
                                    <img class="d-block w-100" th:src="${picture.url}" alt="First slide">
                                </div>
                            </div>
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#Profile" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#Profile" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
                <h1><a class="gym-name" th:href="@{/gym/{id}(id=${gym.id})}" th:text="${gym.name}"></a></h1>
                <div class="card-content" style="color: black">
                    <h4 class="card-text gym-description" th:text="${gym.description}"></h4>
                    <p class="card-text gym-address" th:text="${gym.address}"></p>
                    <p class="gym-id d-none" th:text="${gym.id}"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="col-4 ml-auto d-none d-lg-block d-lg-block overflow-auto scroll-container overlay"
     style="background-color: #1a1819">
    <div th:each="gym : ${gyms}">
        <div class="card offwhite-body" style="margin: 5%; max-width: 85%">
            <div class="preview-post">
                <div id="Large" class="card-img-top carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#Large" data-slide-to="0" class="active"></li>
                        <li data-target="#Large" data-slide-to="1"></li>
                        <li data-target="#Large" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div th:each="picture : ${pictures}">
                            <div th:if="${picture.gym.getId()} == ${gym.id}">
                                <div class="carousel-item active">
                                    <img class="d-block w-100" th:src="${picture.url}" alt="First slide">
                                </div>
                            </div>
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#Large" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#Large" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
                <h1><a class="gym-name " th:href="@{/gym/{id}(id=${gym.id})}" th:text="${gym.name}"></a></h1>
                <div class="card-content" style="color: black">
                    <h4 class="card-text gym-description" th:text="${gym.description}"></h4>
                    <p class="card-text gym-address" th:text="${gym.address}"></p>
                    <p class="gym-id d-none" th:text="${gym.id}"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class=" d-xl-none d-md-none d-lg-none d-block overflow-auto" style="padding: 10px;background-color: #1a1819;">
    <div th:each="gym : ${gyms}">
        <div class="card offwhite-body">
            <div class="preview-post">
                <div id="carouselExampleIndicators" class="card-img-top carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div th:each="picture : ${pictures}">
                            <div th:if="${picture.gym.getId()} == ${gym.id}">
                                <div class="carousel-item active">
                                    <img class="d-block w-100" th:src="${picture.url}" alt="First slide">
                                </div>
                            </div>
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>

                <h1><a class="gym-name" th:href="@{/gym/{id}(id=${gym.id})}" th:text="${gym.name}"></a></h1>
                <div class="card-content" style="color: black">
                    <h4 class="card-text gym-description" th:text="${gym.description}"></h4>
                    <p class="card-text gym-address" th:text="${gym.address}"></p>
                    <p class="gym-id d-none" th:text="${gym.id}"></p>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
        crossorigin="anonymous"></script>
<script>
    let names = $(".gym-name");
    let descriptions = $(".gym-description");
    let addresses = $(".gym-address");
    let ids = $(".gym-id");
    var addressesArray = [];
    function initMap() {

        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 12,
            center: {lat: 29.4241, lng: -98.4936},
            styles: [
                {elementType: "geometry", stylers: [{color: "#242f3e"}]},
                {elementType: "labels.text.stroke", stylers: [{color: "#242f3e"}]},
                {elementType: "labels.text.fill", stylers: [{color: "#746855"}]},
                {
                    featureType: "administrative.locality",
                    elementType: "labels.text.fill",
                    stylers: [{color: "#d59563"}],
                },
                {
                    featureType: "poi",
                    elementType: "labels.text.fill",
                    stylers: [{color: "#d59563"}],
                },
                {
                    featureType: "poi.park",
                    elementType: "geometry",
                    stylers: [{color: "#263c3f"}],
                },
                {
                    featureType: "poi.park",
                    elementType: "labels.text.fill",
                    stylers: [{color: "#6b9a76"}],
                },
                {
                    featureType: "road",
                    elementType: "geometry",
                    stylers: [{color: "#38414e"}],
                },
                {
                    featureType: "road",
                    elementType: "geometry.stroke",
                    stylers: [{color: "#212a37"}],
                },
                {
                    featureType: "road",
                    elementType: "labels.text.fill",
                    stylers: [{color: "#9ca5b3"}],
                },
                {
                    featureType: "road.highway",
                    elementType: "geometry",
                    stylers: [{color: "#746855"}],
                },
                {
                    featureType: "road.highway",
                    elementType: "geometry.stroke",
                    stylers: [{color: "#1f2835"}],
                },
                {
                    featureType: "road.highway",
                    elementType: "labels.text.fill",
                    stylers: [{color: "#f3d19c"}],
                },
                {
                    featureType: "transit",
                    elementType: "geometry",
                    stylers: [{color: "#2f3948"}],
                },
                {
                    featureType: "transit.station",
                    elementType: "labels.text.fill",
                    stylers: [{color: "#d59563"}],
                },
                {
                    featureType: "water",
                    elementType: "geometry",
                    stylers: [{color: "#17263c"}],
                },
                {
                    featureType: "water",
                    elementType: "labels.text.fill",
                    stylers: [{color: "#515c6d"}],
                },
                {
                    featureType: "water",
                    elementType: "labels.text.stroke",
                    stylers: [{color: "#17263c"}],
                },
            ],
        });

        const geocoder = new google.maps.Geocoder();

        for (var i = 0; i < addresses.length; i++) {
            var gymDescription = descriptions[i].innerHTML;
            var gymName = names[i].innerHTML;
            var add = addresses[i].innerHTML;
            var id = ids[i].innerHTML;
            const popupString =
                '<div class="">' +
                '<h1 class=""><a href="' + "/gym/" + id + '">' + gymName + '</a></h1>' +
                '<h3 class="">' + gymDescription + '</h3>' +
                '<h5 class="">' + add + '</h5>' +
                '</div>';
            const infowindow = new google.maps.InfoWindow({
                content: popupString,
            });

            geocoder
                .geocode({address: add})
                .then(({results}) => {
                    let marker = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location,
                    });
                    marker.addListener("click", () => {
                        infowindow.open({
                            anchor: marker,
                            map: map,
                            shouldFocus: false,
                        });
                    });
                })
        }
    }
    function geocodeAddress(geocoder, resultsMap) {
        const address = document.getElementById("address").value;
        geocoder
            .geocode({address: address})
            .then(({results}) => {
                resultsMap.setCenter(results[0].geometry.location);
                new google.maps.Marker({
                    map: resultsMap,
                    position: results[0].geometry.location,
                });
            })
            .catch((e) =>
                alert("Geocode was not successful for the following reason: " + e)
            );
    }
</script>
<script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsja5qGJUGO7Ly0q89b5DaLBaxFNzOnJY&callback=initMap&libraries=&v=weekly"
        async
></script>
<th:block th:include="partials/scripts.html :: script"/>
</body>
</html>